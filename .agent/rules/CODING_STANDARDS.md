---
trigger: always_on
---

# ğŸ“œ DocTranslation Supreme Protocol (í”„ë¡œì íŠ¸ ì ˆëŒ€ ê·œì¹™)

ì´ ë¬¸ì„œëŠ” í”„ë¡œì íŠ¸ ë‚´ ëª¨ë“  ì—ì´ì „íŠ¸ì™€ ì‘ì—…ìê°€ ë°˜ë“œì‹œ ì¤€ìˆ˜í•´ì•¼ í•˜ëŠ” ìµœìƒìœ„ ê·œì¹™ì„ ì •ì˜í•©ë‹ˆë‹¤. ì˜ˆì™¸ëŠ” ì—†ìŠµë‹ˆë‹¤.

## 0. ğŸ‡°ğŸ‡· Korean First Policy (í•œêµ­ì–´ ìš°ì„  ì •ì±…) - **ABSOLUTE PRIORITY**

ëª¨ë“  ì¶œë ¥ë¬¼ì€ **í•œêµ­ì–´**ë¡œ ì‘ì„±ë˜ì–´ì•¼ í•©ë‹ˆë‹¤.

- **ëŒ€í™” (Conversation)**: ì‚¬ìš©ìì™€ì˜ ëª¨ë“  ëŒ€í™”ëŠ” ì •ì¤‘í•œ í•œêµ­ì–´(`í•´ìš”ì²´` ë˜ëŠ” `í•˜ì‹­ì‹œì˜¤ì²´`)ë¥¼ ì‚¬ìš©.
- **ë¬¸ì„œ (Documentation)**: README, ê¸°íšì„œ, ê°€ì´ë“œ ë“± ëª¨ë“  ë¬¸ì„œëŠ” í•œêµ­ì–´ ê¸°ì¤€. (êµ­ì œí™” í•„ìš” í…ìŠ¤íŠ¸ ì œì™¸)
- **ì£¼ì„ (Code Comments)**: ì½”ë“œ ë‚´ ëª¨ë“  ì„¤ëª… ì£¼ì„ì€ í•œêµ­ì–´ë¡œ ì‘ì„±.
- **ì»¤ë°‹ ë©”ì‹œì§€ (Commits)**: `feat: ë¡œê·¸ì¸ ê¸°ëŠ¥ ì¶”ê°€` ì™€ ê°™ì´ í•œê¸€ ì„¤ëª… í¬í•¨ ê¶Œì¥.

## 1. ğŸ‘¥ Agent Swarm Protocol (ì—ì´ì „íŠ¸ ë³´ê³  ì²´ê³„)

ëª¨ë“  ë‹µë³€ê³¼ ì‘ì—…ì€ ì±…ì„ ì†Œì¬ë¥¼ ëª…í™•íˆ í•˜ê¸° ìœ„í•´ ë‹´ë‹¹ **í˜ë¥´ì†Œë‚˜(Persona)**ë¥¼ ëª…ì‹œí•´ì•¼ í•©ë‹ˆë‹¤.

### Active Agents (ì†Œí™˜ ê°€ëŠ¥í•œ ì—ì´ì „íŠ¸)

- **ğŸ§‘â€ğŸ’» @PM (Project Manager)**: ì „ì²´ ì¼ì • ê´€ë¦¬, `task.md` ì—…ë°ì´íŠ¸, ì§„í–‰ ìƒí™© ìš”ì•½.
- **ğŸ—ï¸ @Architect**: ì‹œìŠ¤í…œ ì„¤ê³„, DB ìŠ¤í‚¤ë§ˆ ì •ì˜, ê¸°ìˆ  ìŠ¤íƒ ê²°ì •.
- **ğŸ›¡ï¸ @Guardian**: ë³´ì•ˆ(Security), ì¸ì¦(Auth), ê²°ì œ(Payment) ì •ì±… ê°ì‹œ.
- **ğŸ”¨ @Builder**: ì‹¤ì œ ì½”ë“œ êµ¬í˜„, ë¦¬íŒ©í† ë§, ë²„ê·¸ ìˆ˜ì •.
- **ğŸ‘® @Reviewer**: ì½”ë“œ í’ˆì§ˆ ê²€ì‚¬, ì»¨ë²¤ì…˜(Lint/Format) ì¤€ìˆ˜ í™•ì¸.
- **ğŸ¨ @Designer**: UI/UX ë””ìì¸, ì»´í¬ë„ŒíŠ¸ ìŠ¤íƒ€ì¼ë§, ë°˜ì‘í˜• ì²˜ë¦¬.

### Report Format (ë³´ê³  í˜•ì‹)

ëª¨ë“  ë‹µë³€ì˜ ì„œë‘ ë˜ëŠ” ê²°ë¡ ì— ë‹¤ìŒ í˜•ì‹ì„ ì‚¬ìš©í•˜ì—¬ ëˆ„ê°€ ë¬´ì—‡ì„ í–ˆëŠ”ì§€ ë³´ê³ í•˜ì‹­ì‹œì˜¤.

```markdown
### ğŸ“¢ Agent Report

- **@Architect**: DB ìŠ¤í‚¤ë§ˆ ë³€ê²½ ì‚¬í•­ ìŠ¹ì¸ (profiles í…Œì´ë¸”)
- **@Builder**: ìë™ ë¡œê·¸ì•„ì›ƒ íƒ€ì´ë¨¸ êµ¬í˜„ ì™„ë£Œ
- **@Guardian**: ì„¸ì…˜ íƒ€ì„ì•„ì›ƒ 1ì‹œê°„ ì •ì±… ê²€ì¦ ì™„ë£Œ
- **@PM**: Phase 0.5 - Step 3 ì²´í¬ë¦¬ìŠ¤íŠ¸ ê°±ì‹  ì™„ë£Œ
```

## 2. âœ… Checklist Discipline (ì²´í¬ë¦¬ìŠ¤íŠ¸ ê·œìœ¨)

ì‘ì—…ì´ ì™„ë£Œë  ë•Œë§ˆë‹¤ ë°˜ë“œì‹œ `task.md`ë¥¼ ìµœì‹  ìƒíƒœë¡œ ê°±ì‹ í•´ì•¼ í•©ë‹ˆë‹¤.

- ë‹¨ìˆœíˆ "í–ˆìŠµë‹ˆë‹¤"ë¼ê³  ë§í•˜ì§€ ë§ê³ , **ì²´í¬ë°•ìŠ¤(`[x]`)ê°€ í‘œì‹œëœ `task.md`ì˜ Diff**ë¥¼ ë³´ì—¬ì£¼ê±°ë‚˜ ë§í¬ë¥¼ ì œê³µí•˜ì‹­ì‹œì˜¤.
- ì‘ì—… ì „: ê³„íš ìˆ˜ë¦½ ë° ì²´í¬ë¦¬ìŠ¤íŠ¸ ì‘ì„±.
- ì‘ì—… í›„: í•´ë‹¹ í•­ëª© ì²´í¬(`[x]`) ë° ë‹¤ìŒ ë‹¨ê³„ ì˜ˆê³ .

## 3. ğŸ’» Coding Conventions (ì½”ë”© ì»¨ë²¤ì…˜)

- **Framework**: Next.js 14+ (App Router)
- **Language**: TypeScript (Strict Mode)
- **Style**: Tailwind CSS
- **State**: Server State(React Query/Server Actions), Client State(Zustand/Context)
- **Database**: Supabase (PostgreSQL)

## ì–¸ì–´ë³„ ê·œì¹™ (Language-Specific Rules)

### TypeScript (Next.js 15 - apps/web)

#### 1. ì—„ê²©í•œ íƒ€ì… ì‹œìŠ¤í…œ

```json
// tsconfig.json
{
  "compilerOptions": {
    "strict": true,
    "noUncheckedIndexedAccess": true,
    "noImplicitAny": true,
    "strictNullChecks": true
  }
}
```

#### 2. ë„¤ì´ë° ì»¨ë²¤ì…˜

- **íŒŒì¼ëª…**: `kebab-case.tsx` (ì˜ˆ: `upload-form.tsx`)
- **ì»´í¬ë„ŒíŠ¸**: `PascalCase` (ì˜ˆ: `UploadForm`)
- **í•¨ìˆ˜/ë³€ìˆ˜**: `camelCase` (ì˜ˆ: `handleUpload`)
- **ìƒìˆ˜**: `UPPER_SNAKE_CASE` (ì˜ˆ: `MAX_FILE_SIZE`)

#### 3. Server Actions í‘œì¤€

```typescript
// âœ… ì¢‹ì€ ì˜ˆ: apps/web/src/app/actions/translation.ts
"use server";

import { z } from "zod";
import { createClient } from "@/lib/supabase/server";

// Zod ìŠ¤í‚¤ë§ˆë¡œ ì…ë ¥ ê²€ì¦
const uploadSchema = z.object({
  file: z.instanceof(File),
  targetLang: z.enum(["Korean", "English", "Japanese", "Chinese"]),
});

export async function uploadFile(formData: FormData) {
  // 1. ì…ë ¥ ê²€ì¦
  const parsed = uploadSchema.safeParse({
    file: formData.get("file"),
    targetLang: formData.get("targetLang"),
  });

  if (!parsed.success) {
    return { error: parsed.error.flatten().fieldErrors };
  }

  // 2. ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§
  const supabase = createClient();
  // ...

  // 3. ëª…ì‹œì  ë°˜í™˜ íƒ€ì…
  return { success: true, jobId: "..." };
}
```

#### 4. React ì»´í¬ë„ŒíŠ¸ êµ¬ì¡°

```typescript
// ìˆœì„œ ì¤€ìˆ˜
'use client' // í•„ìš”ì‹œ

import { ... } from 'react'
import { ... } from 'third-party'
import { ... } from '@/components'
import { ... } from '@/lib'

interface Props {
  // PropsëŠ” í•­ìƒ ì¸í„°í˜ì´ìŠ¤ë¡œ ì •ì˜
}

export default function Component({ ... }: Props) {
  // 1. Hooks
  // 2. Event Handlers
  // 3. Derived State
  // 4. JSX Return
}
```

### Python (FastAPI - apps/worker)

#### 1. íƒ€ì… íŒíŠ¸ í•„ìˆ˜

```python
from typing import Optional, List, Dict, Any

# âŒ ë‚˜ìœ ì˜ˆ
def process(data):
    return data['result']

# âœ… ì¢‹ì€ ì˜ˆ
def process_job(job_data: Dict[str, Any]) -> Optional[str]:
    """
    ë²ˆì—­ ì‘ì—…ì„ ì²˜ë¦¬í•©ë‹ˆë‹¤.

    Args:
        job_data: Redisì—ì„œ ë°›ì€ ì‘ì—… ë°ì´í„°

    Returns:
        ì„±ê³µ ì‹œ ì‘ì—… ID, ì‹¤íŒ¨ ì‹œ None
    """
    return job_data.get('job_id')
```

#### 2. ë„¤ì´ë° ì»¨ë²¤ì…˜

- **íŒŒì¼ëª…**: `snake_case.py` (ì˜ˆ: `gemini_client.py`)
- **í´ë˜ìŠ¤**: `PascalCase` (ì˜ˆ: `DocumentTranslator`)
- **í•¨ìˆ˜/ë³€ìˆ˜**: `snake_case` (ì˜ˆ: `translate_batch`)
- **ìƒìˆ˜**: `UPPER_SNAKE_CASE` (ì˜ˆ: `MAX_RETRIES`)

#### 3. ë¹„ë™ê¸° í•¨ìˆ˜ ìš°ì„ 

```python
# âœ… ê¶Œì¥: I/O ì‘ì—…ì€ asyncë¡œ
import asyncio
import aiohttp

async def download_file(url: str) -> bytes:
    async with aiohttp.ClientSession() as session:
        async with session.get(url) as response:
            return await response.read()
```

#### 4. ì—ëŸ¬ ì²˜ë¦¬

```python
# âœ… êµ¬ì²´ì ì¸ ì˜ˆì™¸ë§Œ ìºì¹˜
try:
    result = await risky_operation()
except ValueError as e:
    # ValueErrorë§Œ ì²˜ë¦¬
    logger.error(f"Invalid value: {e}")
    raise
except Exception as e:
    # ìµœí›„ì˜ ì•ˆì „ë§
    logger.critical(f"Unexpected error: {e}")
    raise
```

## ê³µí†µ ì›ì¹™ (Universal Principles)

### 1. SOLID ì›ì¹™

#### S - Single Responsibility

```python
# âŒ ë„ˆë¬´ ë§ì€ ì±…ì„
class DocumentProcessor:
    def parse(self): ...
    def translate(self): ...
    def upload(self): ...
    def send_email(self): ...

# âœ… ì±…ì„ ë¶„ë¦¬
class DocumentParser:
    def parse(self): ...

class DocumentTranslator:
    def translate(self): ...

class StorageUploader:
    def upload(self): ...
```

#### O - Open/Closed (í™•ì¥ì—ëŠ” ì—´ë ¤ìˆê³  ìˆ˜ì •ì—ëŠ” ë‹«í˜€ìˆìŒ)

```python
from abc import ABC, abstractmethod

class DocumentParser(ABC):
    @abstractmethod
    def parse(self, file_bytes: bytes) -> List[str]:
        pass

class DOCXParser(DocumentParser):
    def parse(self, file_bytes: bytes) -> List[str]:
        # DOCX íŒŒì‹± ë¡œì§

class XLSXParser(DocumentParser):
    def parse(self, file_bytes: bytes) -> List[str]:
        # XLSX íŒŒì‹± ë¡œì§

# ìƒˆë¡œìš´ í˜•ì‹ ì¶”ê°€ ì‹œ ê¸°ì¡´ ì½”ë“œ ìˆ˜ì • ì—†ì´ í™•ì¥
class PDFParser(DocumentParser):
    def parse(self, file_bytes: bytes) -> List[str]:
        # PDF íŒŒì‹± ë¡œì§
```

#### D - Dependency Inversion

```python
# âœ… ì¶”ìƒí™”ì— ì˜ì¡´
class TranslationService:
    def __init__(self, ai_client: AIClient):  # êµ¬ì²´ í´ë˜ìŠ¤ ëŒ€ì‹  ì¸í„°í˜ì´ìŠ¤
        self.ai = ai_client

    def translate(self, text: str) -> str:
        return self.ai.generate(text)

# Gemini ëŒ€ì‹  OpenAIë¡œ êµì²´ ê°€ëŠ¥
gemini = GeminiClient()
service = TranslationService(gemini)
```

### 2. DRY (Don't Repeat Yourself)

#### âŒ ì¤‘ë³µ

```typescript
// ì—¬ëŸ¬ íŒŒì¼ì— ë°˜ë³µ
const supabase = createClient(
  process.env.NEXT_PUBLIC_SUPABASE_URL!,
  process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY!,
);
```

#### âœ… ì¤‘ì•™í™”

```typescript
// lib/supabase/client.ts
export const createBrowserClient = () => {
  return createClient(
    process.env.NEXT_PUBLIC_SUPABASE_URL!,
    process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY!,
  );
};

// ë‹¤ë¥¸ íŒŒì¼ì—ì„œ
import { createBrowserClient } from "@/lib/supabase/client";
const supabase = createBrowserClient();
```

### 3. KISS (Keep It Simple, Stupid)

```python
# âŒ ê³¼ë„í•œ ì¶”ìƒí™”
class AbstractFactoryProvider:
    def get_factory(self):
        return Factory().create_builder().build()

# âœ… ë‹¨ìˆœ ëª…ë£Œ
def create_translator() -> DocumentTranslator:
    return DocumentTranslator(gemini_api_key=os.getenv('GEMINI_API_KEY'))
```

## ì£¼ì„ ì‘ì„± ê·œì¹™ (Documentation Standards)

### TypeScript - JSDoc

```typescript
/**
 * íŒŒì¼ì„ Supabase Storageì— ì—…ë¡œë“œí•˜ê³  ë²ˆì—­ ì‘ì—…ì„ íì— ì¶”ê°€í•©ë‹ˆë‹¤.
 *
 * @param formData - íŒŒì¼ê³¼ ì˜µì…˜ì„ í¬í•¨í•œ FormData ê°ì²´
 * @returns ì„±ê³µ ì‹œ ì‘ì—… ID, ì‹¤íŒ¨ ì‹œ ì—ëŸ¬ ë©”ì‹œì§€
 *
 * @example
 * const formData = new FormData()
 * formData.append('file', file)
 * formData.append('targetLang', 'Korean')
 * const result = await uploadFile(formData)
 */
export async function uploadFile(formData: FormData): Promise<Result> {
  // ...
}
```

### Python - Google Docstring

```python
def translate_batch(texts: List[str], target_lang: str) -> List[str]:
    """
    í…ìŠ¤íŠ¸ ë°°ì—´ì„ Gemini APIë¡œ ì¼ê´„ ë²ˆì—­í•©ë‹ˆë‹¤.

    Args:
        texts: ë²ˆì—­í•  í…ìŠ¤íŠ¸ ëª©ë¡ (ìµœëŒ€ 100ê°œ)
        target_lang: ëŒ€ìƒ ì–¸ì–´ (ì˜ˆ: 'Korean', 'English')

    Returns:
        ë²ˆì—­ëœ í…ìŠ¤íŠ¸ ëª©ë¡ (ì…ë ¥ê³¼ ë™ì¼í•œ ìˆœì„œ)

    Raises:
        ValueError: textsê°€ ë¹ˆ ë¦¬ìŠ¤íŠ¸ì¸ ê²½ìš°
        APIError: Gemini API í˜¸ì¶œ ì‹¤íŒ¨ ì‹œ

    Example:
        >>> translate_batch(['Hello', 'World'], 'Korean')
        ['ì•ˆë…•í•˜ì„¸ìš”', 'ì„¸ê³„']
    """
```

## í…ŒìŠ¤íŠ¸ í‘œì¤€ (Testing Standards)

### Unit Test ì»¤ë²„ë¦¬ì§€ ëª©í‘œ

- **í•µì‹¬ ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§**: 100%
- **ìœ í‹¸ë¦¬í‹° í•¨ìˆ˜**: 90%
- **UI ì»´í¬ë„ŒíŠ¸**: 70%

### í…ŒìŠ¤íŠ¸ ë„¤ì´ë°

```python
# âœ… ëª…í™•í•œ í…ŒìŠ¤íŠ¸ ì´ë¦„
def test_translate_docx_preserves_formatting():
    """DOCX ë²ˆì—­ ì‹œ ì›ë³¸ ì„œì‹ì´ ìœ ì§€ë˜ëŠ”ì§€ ê²€ì¦"""

def test_upload_rejects_files_over_50mb():
    """50MB ì´ˆê³¼ íŒŒì¼ ì—…ë¡œë“œ ì‹œ ì—ëŸ¬ ë°˜í™˜ ê²€ì¦"""
```

## ì»¤ë°‹ ë©”ì‹œì§€ ì»¨ë²¤ì…˜ (Conventional Commits)

```
<type>(<scope>): <subject>

<body>

<footer>
```

**Types**:

- `feat`: ìƒˆë¡œìš´ ê¸°ëŠ¥
- `fix`: ë²„ê·¸ ìˆ˜ì •
- `docs`: ë¬¸ì„œ ìˆ˜ì •
- `refactor`: ë¦¬íŒ©í† ë§ (ê¸°ëŠ¥ ë³€ê²½ ì—†ìŒ)
- `test`: í…ŒìŠ¤íŠ¸ ì¶”ê°€/ìˆ˜ì •
- `chore`: ë¹Œë“œ/ì„¤ì • ë³€ê²½

**ì˜ˆì‹œ**:

```
feat(worker): Gemini 2.0 Flash í†µí•©

- gemini_client.pyì—ì„œ batch_translate í•¨ìˆ˜ êµ¬í˜„
- JSON ëª¨ë“œ ê°•ì œë¡œ êµ¬ì¡°í™”ëœ ì¶œë ¥ ë³´ì¥
- ìµœëŒ€ 100ê°œ í…ìŠ¤íŠ¸ ì¼ê´„ ì²˜ë¦¬ ì§€ì›

Closes #42
```

## ì„±ëŠ¥ ê°€ì´ë“œë¼ì¸

### Next.js

1. **Dynamic Import**: í° ì»´í¬ë„ŒíŠ¸ëŠ” ì§€ì—° ë¡œë”©

   ```typescript
   const HeavyChart = dynamic(() => import('./HeavyChart'), {
     loading: () => <Spinner />
   })
   ```

2. **Image Optimization**: `next/image` ì‚¬ìš©
   ```tsx
   <Image src="/logo.png" width={200} height={200} alt="Logo" />
   ```

### Python Worker

1. **Connection Pooling**: DB/Redis ì—°ê²° ì¬ì‚¬ìš©
2. **Batch Processing**: Gemini API í˜¸ì¶œ ìµœì†Œí™”
3. **Async I/O**: `asyncio` + `aiohttp` ì‚¬ìš©

## ë³´ì•ˆ ì²´í¬ë¦¬ìŠ¤íŠ¸

- [ ] ëª¨ë“  ì‚¬ìš©ì ì…ë ¥ì„ Zod/Pydanticìœ¼ë¡œ ê²€ì¦
- [ ] API Keyë¥¼ í™˜ê²½ ë³€ìˆ˜ë¡œ ê²©ë¦¬
- [ ] SQL Injection ë°©ì§€ (ORM ì‚¬ìš©)
- [ ] XSS ë°©ì§€ (ReactëŠ” ê¸°ë³¸ ë°©ì–´, ì¶”ê°€ sanitization)
- [ ] Rate Limiting ì ìš©
